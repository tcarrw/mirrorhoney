<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MirrorHoney</title>
<meta name="description" content="MirrorHoney ‚Äî play one song, breathe one tone, write one line." />
<meta name="color-scheme" content="dark light" />

<style>
  :root{
    --accent:#ffd089; --bg0:#0b0d10; --bg1:#12151b; --card:#141821;
    --pill:#1b1f27; --btn:#1b2130; --btnH:#263049; --border:rgba(255,255,255,.26);
    --text:#dbe2ee; --text-strong:#f3f6fb; --text-soft:#b8c2d4;
    --glow:0 10px 36px rgba(255,208,137,.26);
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg0:#fff9ee; --bg1:#fff4e1; --card:#fffdf8; --pill:#fff; --btn:#fff; --btnH:#f4efe6;
      --border:rgba(0,0,0,.26); --text:#20242c; --text-strong:#111318; --text-soft:#4b5567;
      --glow:0 10px 36px rgba(255,208,137,.28);
    }
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--text);
    font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:
      radial-gradient(1100px 520px at 8% -10%, color-mix(in oklab, var(--accent), transparent 80%), transparent 60%),
      radial-gradient(1000px 520px at 100% 110%, color-mix(in oklab, var(--accent), transparent 82%), transparent 60%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    min-height:100svh;
  }
  header.nav{
    position:sticky; top:0; z-index:3; display:flex; gap:.6rem; flex-wrap:wrap; align-items:center;
    padding:12px 16px; backdrop-filter:blur(8px);
    background:color-mix(in oklab, var(--bg0), transparent 36%);
    border-bottom:1px solid color-mix(in oklab, var(--border), transparent 18%);
  }
  .pill{
    display:inline-flex; align-items:center; gap:.5rem; text-decoration:none;
    color:var(--text-strong); background:var(--pill);
    border:1px solid var(--border); padding:.44rem .8rem; border-radius:999px;
  }
  .pill[aria-disabled="true"]{opacity:.6; pointer-events:none}

  main{max-width:980px; margin:0 auto; padding:26px 16px 56px}
  .card{border:1px solid var(--border); border-radius:18px; overflow:hidden; background:var(--card); box-shadow:var(--glow)}
  .hero{padding:20px 20px 0; border-bottom:1px solid color-mix(in oklab, var(--border), transparent 26%)}
  h1{margin:.1rem 0 .1rem; font-size:clamp(22px,3.4vw,32px); font-weight:800; color:var(--text-strong)}
  p.purpose{margin:.2rem 0 1rem; color:var(--text-soft)}

  .section{padding:16px 20px 22px}
  .vid-wrap{width:100%; aspect-ratio:16/9; background:#000; border-radius:14px; overflow:hidden; border:1px solid var(--border)}
  .vid-wrap iframe{width:100%; height:100%; display:block; border:0}

  .controls{display:flex; gap:.6rem; flex-wrap:wrap; margin:12px 0 2px}
  .btn{appearance:none; cursor:pointer; border:1px solid var(--border); background:var(--btn); color:var(--text);
       border-radius:12px; padding:.62rem .9rem; font-weight:600}
  .btn:hover{background:var(--btnH)} .btn:focus-visible{outline:3px solid color-mix(in oklab, var(--accent), transparent 35%); outline-offset:2px}
  .btn:active{transform:translateY(1px)}

  .notebox{display:flex; flex-direction:column; gap:.35rem; margin-top:.5rem; width:100%}
  .notebox textarea{width:100%; min-height:88px; resize:vertical; border:1px solid var(--border); border-radius:12px; background:var(--btn); color:var(--text); padding:.7rem .85rem}
  .notebox small{opacity:.88; color:var(--text-soft)}

  .next{margin:16px 0 0}
  .next a{color:var(--text-strong); text-decoration:none; border-bottom:1px dashed color-mix(in oklab, var(--border), transparent 35%)}

  details.more{margin-top:18px}
  summary{cursor:pointer; color:var(--text-strong)}
  .more-box{display:flex; flex-wrap:wrap; gap:.5rem; margin-top:.6rem}
  .badge{font:12px system-ui; opacity:.8; margin-top:8px; color:var(--text-soft)}

  .honey-film{pointer-events:none; position:fixed; inset:0; z-index:1; mix-blend-mode:soft-light; opacity:0;
    background: radial-gradient(1200px 600px at 0% 0%, color-mix(in oklab, var(--accent), transparent 60%), transparent 60%),
                radial-gradient(800px 400px at 100% 100%, color-mix(in oklab, var(--accent), transparent 72%), transparent 60%);
    transition:opacity .25s ease}
</style>
</head>
<body>

<div class="honey-film" id="honeyFilm" aria-hidden="true"></div>

<header class="nav" data-plnt="nav" aria-label="Global navigation"></header>

<main>
  <div class="card">
    <div class="hero">
      <h1 data-plnt="title">üçØ MirrorHoney</h1>
      <p class="purpose" data-plnt="purpose">Play one song, breathe one tone, write one line.</p>
    </div>

    <div class="section">
      <section class="vid-wrap" aria-label="Featured video">
        <!-- Default to Hello Kitty; JSON can override -->
        <iframe id="mh-video"
          title="MirrorHoney Video"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen loading="lazy" referrerpolicy="strict-origin-when-cross-origin"
          src="https://www.youtube-nocookie.com/embed/81tlcIq4kPA?rel=0&modestbranding=1&playsinline=1">
        </iframe>
      </section>

      <!-- Actions from JSON render here -->
      <div class="controls" data-plnt="actions" aria-label="Actions"></div>

      <p class="next" data-plnt="next"></p>

      <details class="more">
        <summary>More</summary>
        <div class="more-box" data-plnt="more"></div>
        <div id="nav-health" class="badge" aria-live="polite"></div>
      </details>
    </div>
  </div>
</main>

<script>
/* identity & canon */
window.CURRENT_SLUG = "mirrorhoney";
const CANON = "https://www.plnt.earth/rooms.json";
const CACHE_KEY = "plnt.rooms.v1";

/* helpers (no logs) */
function $(sel){ return document.querySelector(sel); }
function setVideoFromUrl(url){
  try{
    var id="",start=0,u=new URL(url);
    if(u.hostname.includes("youtu.be")) id=u.pathname.slice(1);
    if(u.hostname.includes("youtube")) id=u.searchParams.get("v")||"";
    var t=u.searchParams.get("t")||u.searchParams.get("start")||"";
    if(t){ var s=(t+"").replace(/s$/,""); if(!isNaN(parseInt(s,10))) start=parseInt(s,10); }
    if(!id) return false;
    var src="https://www.youtube-nocookie.com/embed/"+id+"?rel=0&modestbranding=1&playsinline=1";
    if(start>0) src+="&start="+start;
    var f=$("#mh-video"); if(f) f.src=src;
    return true;
  }catch(_){ return false; }
}
function roomLink(room){
  var href="https://"+room.slug+".plnt.earth";
  if(room.coming_soon||room.status!=="live") return {label:(room.glyph?room.glyph+" ":"")+room.title+" ‚Äî Coming Soon",href:"#",disabled:true};
  return {label:(room.glyph?room.glyph+" ":"")+room.title,href:href,disabled:false};
}

/* fetch rooms.json with fallback + cache */
(async function(){
  var inline=null,cached=null;
  try{ var el=document.getElementById("rooms-fallback"); if(el) inline=JSON.parse(el.textContent);}catch(_){}
  try{ cached=JSON.parse(localStorage.getItem(CACHE_KEY)); }catch(_){}
  var data=cached||inline||null, badge=document.getElementById("nav-health");

  try{
    var r=await fetch(CANON,{mode:"cors",cache:"no-store"});
    if(r.ok){
      var fresh=await r.json();
      data=fresh; try{ localStorage.setItem(CACHE_KEY,JSON.stringify(fresh)); }catch(_){}
      if(badge) badge.textContent="Nav: www canon ‚úì";
    } else { if(badge) badge.textContent="Nav issue: status"; }
  }catch(_){ if(badge) badge.textContent="Nav issue: CORS/network"; }

  window.PLNT_ROOMS=data||{rooms:[]};
  renderNav(window.PLNT_ROOMS);
  renderRoom("mirrorhoney");
})();

/* renderers */
function renderNav(d){
  var nav=document.querySelector("[data-plnt=nav]"); if(!nav) return;
  nav.innerHTML="";
  var home=document.createElement("a");
  home.href=d.hub&&d.hub.home?d.hub.home:"https://www.plnt.earth";
  home.textContent=d.hub&&d.hub.title?d.hub.title:"PLNT Earth";
  home.className="pill"; nav.appendChild(home);
  var primary=(d.rooms||[]).filter(r=>r.status==="live").slice(0,7);
  primary.forEach(r=>{
    var i=roomLink(r),a=document.createElement("a");
    a.href=i.href; a.textContent=i.label; a.className="pill";
    if(i.disabled) a.setAttribute("aria-disabled","true");
    nav.appendChild(a);
  });
  var moreBox=document.querySelector("[data-plnt=more]");
  if(moreBox){
    moreBox.innerHTML="";
    var more=(d.rooms||[]).filter(r=>r.status!=="live"||r.coming_soon);
    more.forEach(r=>{
      var i=roomLink(r),a=document.createElement("a");
      a.href=i.href; a.textContent=i.label; a.className="pill";
      if(i.disabled) a.setAttribute("aria-disabled","true");
      moreBox.appendChild(a);
    });
  }
}

function renderRoom(slug){
  var d=window.PLNT_ROOMS||{rooms:[]};
  var room=(d.rooms||[]).find(r=>r.slug===slug)||null;

  var title=$("[data-plnt=title]"), purpose=$("[data-plnt=purpose]");
  if(title){
    var glyph = room && room.glyph ? room.glyph + " " : "";
    var name  = room && room.title ? room.title : "MirrorHoney";
    title.textContent = glyph + name;
  }
  if(purpose) purpose.textContent=room&&room.purpose?room.purpose:"Play one song, breathe one tone, write one line.";

  try{ if(room&&room.theme&&room.theme.color){ document.documentElement.style.setProperty("--accent",room.theme.color); } }catch(_){}

  var actionsBox=document.querySelector("[data-plnt=actions]");
  if(actionsBox){
    actionsBox.innerHTML="";
    var actions=(room&&room.actions)?room.actions.slice(0,3):[];

    actions.forEach(function(a){
      /* NOTE ACTION (inline textarea) */
      if(a.type==="note"){
        var wrap=document.createElement("div"); wrap.className="notebox";
        var label=document.createElement("label"); label.textContent=a.label||"Bee Note";
        var ta=document.createElement("textarea");
        var key=a.key||"mirrorhoney.note";
        try{ var saved=localStorage.getItem(key); if(saved) ta.value=saved; }catch(_){}
        ta.addEventListener("input", function(){ try{ localStorage.setItem(key, ta.value.trim()); }catch(_){} });
        var hint=document.createElement("small"); hint.textContent="Saved locally ¬∑ one line is enough";
        wrap.appendChild(label); wrap.appendChild(ta); wrap.appendChild(hint);
        actionsBox.appendChild(wrap);
        return;
      }

      /* DEFAULT BUTTON ACTIONS */
      var b=document.createElement("button");
      b.type="button"; b.className="btn"; b.textContent=a.label||"Do"; b.dataset.action=a.id||"";
      b.onclick=function(){
        if(a.type==="video"&&a.target){ setVideoFromUrl(a.target); }
        if(a.type==="toggle"){ b.setAttribute("aria-pressed", b.getAttribute("aria-pressed")==="true"?"false":"true"); }
        if(a.type==="tone"&&a.hz){ toneOnce(a.hz,(a.seconds||60)); }
        if(a.type==="slider"){ /* not used in this triad, but supported */ }
        if(a.type==="link"&&a.target){ location.href=a.target; }
      };
      actionsBox.appendChild(b);
    });
  }

  /* prefer JSON video; else keep Hello Kitty default already in iframe */
  try{
    var vidAct=(room&&room.actions)?room.actions.find(x=>x.type==="video"&&x.target):null;
    if(vidAct&&vidAct.target){ setVideoFromUrl(vidAct.target); }
  }catch(_){}

  var next=document.querySelector("[data-plnt=next]");
  if(next){
    next.innerHTML="";
    if(room&&room.next){
      var a=document.createElement("a");
      a.href="https://"+room.next.slug+".plnt.earth";
      a.textContent=room.next.label||"Next ‚Üí";
      next.appendChild(a);
    }
  }

  /* subtle honey film (optional aesthetic if you later re-add slider) */
  var film=document.getElementById("honeyFilm");
  if(film){ film.style.opacity = .22; } /* light, constant warmth */
}

/* tiny WebAudio tone (tap-initiated, iOS-safe) */
function toneOnce(hz,seconds){
  try{
    var ctx=(window._plntAudioCtx)||new (window.AudioContext||window.webkitAudioContext)();
    window._plntAudioCtx=ctx;
    var o=ctx.createOscillator(), g=ctx.createGain();
    o.type="sine"; o.frequency.value=hz||160; g.gain.value=0.0001;
    o.connect(g); g.connect(ctx.destination); o.start();
    var now=ctx.currentTime;
    g.gain.setTargetAtTime(0.09,now,0.05);
    g.gain.setTargetAtTime(0.0001,now+(seconds||60),0.15);
    o.stop(now+(seconds||60)+0.3);
  }catch(_){}
}
</script>

<!-- (Optional) inline fallback shape; usually empty -->
<script id="rooms-fallback" type="application/json">{ "updated": "", "rooms": [] }</script>
</body>
</html>
