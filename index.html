<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MirrorHoney — Marina</title>
<meta name="description" content="MirrorHoney: Marina's violet-pearl reflection — Bee line, lesson, joy, and consent rendered as a single poem, with a Froot color dial." />
<!-- mirrorhoney · marina -->
<style>
  :root{
    /* Base palette */
    --bg:#0d0b12;            /* deep violet */
    --ink:#efeaff;           /* pearl text */
    --muted:#bfb3d9;         /* soft lavender */
    --violet:#cda6ff;        /* pearl-violet glow */
    --vio:#d08bff;           /* accent */
    --rose:#ff9bd6;          /* warmth */
    --mint:#73e3c5;          /* consent green */
    --amber:#ffd089;         /* pending amber */
    --line:#262035;
    --card:#141026f0;

    /* Froot dial variables (updated via JS) */
    --tint: 0;               /* 0..100 */
    --violetA: rgba(208,139,255, calc(0.08 + (var(--tint) * 0.002))); /* 0.08..0.28 */
    --pearlA:  rgba(240,230,255, calc(0.04 + (var(--tint) * 0.0015)));/* subtle pearl lift */
    --halo:    rgba(208,139,255, calc(0.22 + (var(--tint) * 0.002))); /* base glow */
    --skyV:    #1a1433;
    --skyP:    #241b3f;
    --bgMix:   radial-gradient(1200px 900px at 70% 10%,
                  color-mix(in oklab, var(--skyV) calc(100% - var(--tint)*1%), var(--skyP) calc(var(--tint)*1%)) 0%,
                  #0d0b12 58%, #0a0810 100%);
    --shadow:0 14px 44px rgba(0,0,0,.55);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    background:
      var(--bgMix),
      linear-gradient(180deg,
        color-mix(in oklab, #0f0b19 70%, #1a1433 30%) ,
        #0d0b12);
    font:500 16px/1.5 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    transition: background .35s ease;
  }
  .wrap{max-width:980px; margin:0 auto; padding:22px; display:grid; gap:14px}
  .hdr{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap}
  .title{font-weight:900; font-size:26px; letter-spacing:.4px; text-transform:uppercase}
  .tag{font:700 11px ui-monospace,SFMono-Regular,Menlo,monospace; padding:4px 8px; border-radius:999px; border:1px solid rgba(240,230,255,.35); color:#f3ecff; background:rgba(208,139,255,.10)}
  .chips{display:flex; gap:8px; flex-wrap:wrap}
  .chip{
    font:700 11px ui-monospace,SFMono-Regular,Menlo,monospace; padding:4px 8px; border-radius:999px;
    border:1px solid rgba(240,230,255,.35); color:#efeaff; background:rgba(255,255,255,.05)
  }
  .ok{ border-color:rgba(115,227,197,.8); background:rgba(115,227,197,.12); color:#ebfff8}
  .warn{ border-color:rgba(255,208,137,.75); background:rgba(255,208,137,.1); color:#fff3dc}

  .card{
    background:linear-gradient(180deg, rgba(20,16,38,.92), rgba(15,12,28,.92));
    border:1px solid rgba(210,200,255,.2);
    border-radius:16px; padding:16px; box-shadow:var(--shadow);
    backdrop-filter:saturate(130%) blur(6px);
  }
  h2{margin:0 0 8px 0; font-size:18px; letter-spacing:.2px}
  .muted{color:var(--muted); font-size:14px}

  /* Bee line badge */
  .bee{
    display:inline-flex; align-items:center; gap:8px; margin-top:6px;
    border:1px solid rgba(210,200,255,.35); border-radius:999px; padding:6px 10px;
    font:700 12px ui-monospace,SFMono-Regular,Menlo,monospace; color:#f6f0ff; background:rgba(208,139,255,.10)
  }

  /* Pill buttons */
  .pillbtn{
    display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
    border:1px solid rgba(240,230,255,.35); background:rgba(255,255,255,.06); color:#fff;
    font:800 11px ui-monospace,SFMono-Regular,Menlo,monospace; letter-spacing:.12em; text-transform:uppercase; cursor:pointer;
  }
  .pillbtn.violet{ border-color:rgba(208,139,255,.6); background:linear-gradient(180deg, rgba(208,139,255,.16), rgba(208,139,255,.06)) }
  .pillbtn.mint{ border-color:rgba(115,227,197,.65); background:linear-gradient(180deg, rgba(115,227,197,.16), rgba(115,227,197,.06)) }

  .btn{
    display:inline-flex; align-items:center; gap:8px; padding:9px 12px; border-radius:10px; text-decoration:none; cursor:pointer;
    border:1px solid rgba(240,230,255,.35); color:#fff; font-weight:800; letter-spacing:.14em; text-transform:uppercase;
    background:linear-gradient(180deg, rgba(255,255,255,.1), rgba(255,255,255,.05));
  }
  .btn.violet{ border-color:rgba(208,139,255,.6); background:linear-gradient(180deg, rgba(208,139,255,.16), rgba(208,139,255,.06)) }
  .btn.mint{ border-color:rgba(115,227,197,.65); background:linear-gradient(180deg, rgba(115,227,197,.16), rgba(115,227,197,.06)) }

  /* Froot dial block */
  .dial{
    display:flex; align-items:center; gap:10px; flex-wrap:wrap; margin-top:8px;
    border:1px solid rgba(210,200,255,.25); border-radius:12px; padding:10px; background:rgba(255,255,255,.04)
  }
  .dial .meter{font:700 11px ui-monospace,SFMono-Regular,Menlo,monospace; padding:4px 8px; border-radius:999px; border:1px solid rgba(240,230,255,.35); color:#efeaff}
  input[type=range]{ width:220px }

  /* Poem area */
  .poem{
    position:relative; border:1px solid rgba(210,200,255,.25); border-radius:16px; padding:18px; overflow:hidden;
    background:
      radial-gradient(800px 300px at 50% 110%, var(--violetA), transparent 60%),
      linear-gradient(180deg,
        color-mix(in oklab, #1c1535 70%, #2a1f4f 30%),
        color-mix(in oklab, #120d22 80%, #1c1535 20%));
    transition: background .35s ease, box-shadow .35s ease, border-color .35s ease;
  }
  .glow{
    position:absolute; inset:-30% -10% auto -10%; height:60%;
    background:radial-gradient(closest-side, var(--halo), rgba(208,139,255,.12), transparent);
    filter:blur(.6px); mix-blend-mode:screen; pointer-events:none; animation:float 16s linear infinite;
  }
  @keyframes float{ 0%{ transform:translateX(-8%) rotate(-4deg)} 50%{transform:translateX(8%) rotate(4deg)} 100%{transform:translateX(-8%) rotate(-4deg)} }

  .mirror{
    font-size:18px; line-height:1.6; color:#f4eeff; letter-spacing:.2px; white-space:pre-wrap;
    transition:transform .3s ease;
  }
  .mirror.mirrored{ transform:scaleX(-1) }

  .controls{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px }

  .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  @media (max-width:860px){ .grid{ grid-template-columns:1fr } }

  .foot{ text-align:center; color:var(--muted); font-size:12px; padding:8px 0 16px }
  .links{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:8px }
</style>
</head>
<body>
  <main class="wrap">
    <header class="hdr">
      <div>
        <div class="title">MirrorHoney — Marina</div>
        <div id="beeLine" class="bee">—</div>

        <!-- Froot color dial -->
        <div class="dial" aria-label="Froot color dial">
          <strong style="letter-spacing:.3px">Froot Dial</strong>
          <span class="muted">Violet</span>
          <input id="tint" type="range" min="0" max="100" value="0" />
          <span class="muted">Pearl</span>
          <span id="tintMeter" class="meter">0%</span>
          <button id="tintReset" class="btn violet" type="button">Reset</button>

          <!-- Follow Froot (pill switch) -->
          <span class="muted" style="margin-left:6px">Follow on load</span>
          <span id="followFroot" class="pillbtn mint" role="switch" aria-checked="false">
            <span id="followFrootState">OFF</span>
          </span>
        </div>
      </div>
      <div class="chips">
        <span id="chipHarbor" class="chip">harbor: —</span>
        <span id="chipSchool" class="chip">inspector: —</span>
        <span id="chipGarlic" class="chip">garlic path: —</span>
        <span id="chipJoy" class="chip">joy: —</span>
      </div>
    </header>

    <section class="card">
      <h2>Reflection Poem</h2>
      <p class="muted">Violet-pearl mirror composed from Bee line, Taylor’s lesson, today’s Joy, and the consent light. Adjust the Froot dial to tint the room.</p>

      <div class="poem">
        <div class="glow" aria-hidden="true"></div>
        <div id="poem" class="mirror"></div>
      </div>

      <div class="controls">
        <button id="regen" class="btn violet" type="button">Regenerate</button>
        <button id="copy" class="btn" type="button">Copy</button>
        <button id="mirror" class="btn" type="button">Mirror</button>
        <button id="sendFroot" class="btn violet" type="button">Send to Froot</button>

        <!-- NEW: pill-badge “Listen to Froot” -->
        <span id="pullFroot" class="pillbtn violet" role="button" tabindex="0">Listen to Froot</span>

        <a class="btn mint" href="https://earth.plnt.earth" rel="noopener">Earth</a>
        <a class="btn" href="https://garlic.plnt.earth" rel="noopener">Garlic</a>
        <a class="btn" href="https://school.plnt.earth/inspector/" rel="noopener">Inspector</a>
        <a class="btn" href="https://harbor.plnt.earth" rel="noopener">Harbor</a>
        <a class="btn" href="https://dagny.plnt.earth" rel="noopener">Dagny</a>
      </div>
    </section>

    <section class="grid">
      <div class="card">
        <h2>Inputs (read-only)</h2>
        <ul class="muted" style="margin:8px 0 0 0; padding-left:18px">
          <li><strong>Bee line:</strong> <span id="inBee">—</span></li>
          <li><strong>Lesson:</strong> <span id="inLesson">—</span></li>
          <li><strong>Latest Joy:</strong> <span id="inJoy">—</span></li>
          <li><strong>Harbor cleared:</strong> <span id="inHand">—</span></li>
        </ul>
      </div>
      <div class="card">
        <h2>Status</h2>
        <p class="muted" id="status">—</p>
      </div>
    </section>

    <footer class="foot">
      MirrorHoney renders what’s true and kind. Violet-pearl for Marina; motion becomes music.
      <div class="links">
        <a class="btn" href="https://froot.plnt.earth" rel="noopener">Froot</a>
        <a class="btn" href="https://honey.plnt.earth" rel="noopener">Honey</a>
        <a class="btn" href="https://clarity.plnt.earth" rel="noopener">Clarity</a>
        <a class="btn" href="https://time.plnt.earth" rel="noopener">Time</a>
      </div>
    </footer>
  </main>

<script>
(function(){
  // ---------- helpers ----------
  function truthy(v){ if(v==null) return false; var s=String(v).toLowerCase().trim(); return !(s===""||s==="0"||s==="false"||s==="null"||s==="undefined"); }
  function getJSON(k, fb){ try{ var r=localStorage.getItem(k); if(!r) return fb; var v=JSON.parse(r); return v??fb; }catch(e){ return fb; } }
  function fromHTML(key){
    var raw = localStorage.getItem(key)||''; return raw.replace(/<[^>]*>/g,'').replace(/\s+/g,' ').trim();
  }
  function textOrDash(x){ return x && x.trim() ? x.trim() : '—'; }

  // ---------- read inputs ----------
  var bee = fromHTML('school.kit.no');
  var lesson = fromHTML('school.inspector.lessonText');
  if(!lesson){
    var sum = localStorage.getItem('school.inspector.summary')||'';
    var m = /(^|\n)Lesson:\s*(.+)/i.exec(sum);
    if(m) lesson = m[2].trim();
  }
  var joyList = getJSON('dagny.log.v1', []);
  var latestJoy = (Array.isArray(joyList)&&joyList.length) ? (joyList[0].text||'') : '';
  var harborGreen = truthy(localStorage.getItem('harbor.credit')) && truthy(localStorage.getItem('harbor.consent')) && truthy(localStorage.getItem('harbor.resource'));
  var schoolReady = !!(getJSON('illumina.afg.v1', {}).school);
  var garlicPath = (function(){ var s=getJSON('illumina.afg.v1', {}); return ['garlic','school','earth','dagny'].every(function(k){ return !!s[k]; }); })();
  var handHuman = localStorage.getItem('harbor.lastClearedHuman') || (function(){
    var iso = localStorage.getItem('harbor.lastCleared'); try{ return iso? new Date(iso).toLocaleString() : ''; }catch(e){ return ''; }
  })();

  // ---------- chips ----------
  var chipH = document.getElementById('chipHarbor');
  var chipS = document.getElementById('chipSchool');
  var chipG = document.getElementById('chipGarlic');
  var chipJ = document.getElementById('chipJoy');

  chipH.textContent = 'harbor: ' + (harborGreen ? 'green' : 'pending');
  chipH.classList.add(harborGreen ? 'ok':'warn');

  chipS.textContent = 'inspector: ' + (schoolReady ? 'ready' : 'in progress');
  chipS.classList.add(schoolReady ? 'ok':'warn');

  chipG.textContent = 'garlic path: ' + (garlicPath ? 'all green' : 'in progress');
  chipG.classList.add(garlicPath ? 'ok':'warn');

  var joyOk = !!latestJoy;
  chipJ.textContent = 'joy: ' + (joyOk ? 'present' : '—');
  chipJ.classList.add(joyOk ? 'ok':'warn');

  // ---------- inputs panel ----------
  document.getElementById('beeLine').textContent = textOrDash(bee) || '—';
  document.getElementById('inBee').textContent = textOrDash(bee);
  document.getElementById('inLesson').textContent = textOrDash(lesson);
  document.getElementById('inJoy').textContent = textOrDash(latestJoy);
  document.getElementById('inHand').textContent = textOrDash(handHuman);

  // ---------- status summary ----------
  var status = document.getElementById('status');
  var parts = [];
  parts.push(harborGreen ? 'Harbor green' : 'Harbor pending');
  parts.push(schoolReady ? 'Inspector ready' : 'Inspector pending');
  if(handHuman) parts.push('handshake: '+handHuman);
  status.textContent = parts.join(' · ');

  // ---------- poem generator ----------
  var poemEl = document.getElementById('poem');
  function compose(){
    var lines = [];
    if(bee){ lines.push('“'+bee+'”'); }
    if(lesson){ lines.push('Lesson: '+lesson); }
    var gate = [];
    gate.push(harborGreen ? 'consent is green' : 'consent waits');
    gate.push(schoolReady ? 'the lesson holds' : 'the lesson is forming');
    lines.push(gate.join(' · '));
    if(latestJoy){ lines.push('Joy today: '+latestJoy); }
    if(handHuman){ lines.push('We crossed at '+handHuman+'.'); }
    lines.push('Violet keeps the mirror calm. Honey keeps it kind.');
    poemEl.textContent = lines.join('\n');
  }
  compose();

  // ---------- controls ----------
  document.getElementById('regen').addEventListener('click', function(){ compose(); }, {passive:true});
  document.getElementById('copy').addEventListener('click', function(){
    var r = document.createRange(); r.selectNodeContents(poemEl);
    var sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(r);
    try{ document.execCommand('copy'); }catch(e){}
    sel.removeAllRanges();
  }, {passive:true});
  document.getElementById('mirror').addEventListener('click', function(){
    poemEl.classList.toggle('mirrored');
  }, {passive:true});

  // --- Send current tint to Froot ---
  (function(){
    var btn = document.getElementById('sendFroot');
    if(!btn) return;
    btn.addEventListener('click', function(){
      try{
        var n = parseInt(localStorage.getItem('mirrorhoney.tint') || '0', 10);
        localStorage.setItem('froot.currentTint', String(n));
        btn.textContent = 'Sent ✓';
        setTimeout(function(){ btn.textContent = 'Send to Froot'; }, 1400);
      }catch(e){
        btn.textContent = 'Try again';
        setTimeout(function(){ btn.textContent = 'Send to Froot'; }, 1400);
      }
    }, {passive:true});
  })();

  // ---------- Froot color dial ----------
  var tint = document.getElementById('tint');
  var meter = document.getElementById('tintMeter');
  var reset = document.getElementById('tintReset');

  function applyTint(v){
    var n = Math.max(0, Math.min(100, parseInt(v||0,10)));
    document.documentElement.style.setProperty('--tint', n);
    meter.textContent = n + '%';
    try{ localStorage.setItem('mirrorhoney.tint', String(n)); }catch(e){}
  }
  // expose for shim
  window.applyTint = applyTint;

  // restore saved tint
  applyTint(localStorage.getItem('mirrorhoney.tint')||0);
  tint.value = localStorage.getItem('mirrorhoney.tint')||0;

  tint.addEventListener('input', function(e){ applyTint(e.target.value); }, {passive:true});
  reset.addEventListener('click', function(){ tint.value = 0; applyTint(0); }, {passive:true});

  // ---- MirrorHoney ⇄ Froot tint sync (pill badge + follow switch) ----
  function getFrootTint(){
    var v = localStorage.getItem('froot.currentTint');
    var n = parseInt(v==null ? '0' : v, 10);
    if (isNaN(n)) n = 0;
    return n;
  }
  function applyFromFroot(){
    var n = getFrootTint();
    applyTint(n);
    // flash label on pill
    var pill = document.getElementById('pullFroot');
    if(pill){
      var old = pill.textContent; pill.textContent = 'Applied ✓';
      setTimeout(function(){ pill.textContent = old; }, 1200);
    }
  }

  // One-shot pill action
  (function(){
    var pill = document.getElementById('pullFroot');
    if(!pill) return;
    pill.addEventListener('click', applyFromFroot, {passive:true});
    pill.addEventListener('keydown', function(e){
      if(e.key===' '||e.key==='Enter'){ e.preventDefault(); applyFromFroot(); }
    });
  })();

  // Follow on load switch
  (function(){
    var sw = document.getElementById('followFroot');
    var state = document.getElementById('followFrootState');
    if(!sw || !state) return;
    var on = localStorage.getItem('mirrorhoney.followFroot') === 'true';
    function render(){ sw.setAttribute('aria-checked', on ? 'true':'false'); state.textContent = on ? 'ON':'OFF'; }
    function toggle(){ on=!on; try{ localStorage.setItem('mirrorhoney.followFroot', on?'true':'false'); }catch(e){} render(); if(on) applyFromFroot(); }
    sw.addEventListener('click', toggle, {passive:true});
    sw.addEventListener('keydown', function(e){ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); toggle(); }});
    render();
    // if already following, pull immediately on load
    if(on) applyFromFroot();
  })();

})();
</script>
</body>
</html>
