<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MirrorHoney</title>
<meta name="description" content="MirrorHoney ‚Äî one drop of honey, one video, one gentle color tint." />
<meta name="color-scheme" content="dark light" />

<style>
  :root{
    /* Base palette (tuned for contrast) */
    --accent: #ffd089;             /* honey */
    --ink: #0f1115;                /* dark text in light mode */
    --ink-weak: #2a2e36;
    --bg0: #0b0d10;                /* dark background */
    --bg1: #12151b;
    --ring: rgba(255,255,255,.20); /* borders in dark mode */
    --pill-bg: #1b1f27;
    --card-bg: #141821;
    --btn-bg: #1b2130;
    --btn-bg-hover: #263049;
    --btn-border: rgba(255,255,255,.28);
    --text-strong: #f3f6fb;        /* high-contrast text */
    --text: #dbe2ee;
    --text-soft: #b7c1d4;
    --glow: 0 10px 36px rgba(255, 208, 137, .26);
  }
  @media (prefers-color-scheme: light){
    :root{
      --ink:#0f1115; --ink-weak:#333a46;
      --bg0:#fff9ee; --bg1:#fff4e1;
      --ring: rgba(0,0,0,.22);
      --pill-bg: #fff;
      --card-bg: #fffdf8;
      --btn-bg: #ffffff;
      --btn-bg-hover: #f4efe6;
      --btn-border: rgba(0,0,0,.28);
      --text-strong:#111318;
      --text:#20242c;
      --text-soft:#4b5567;
      --glow: 0 10px 36px rgba(255, 208, 137, .28);
    }
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    color:var(--text);
    font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:
      radial-gradient(1100px 520px at 8% -10%, color-mix(in oklab, var(--accent), transparent 80%), transparent 60%),
      radial-gradient(1000px 520px at 100% 110%, color-mix(in oklab, var(--accent), transparent 82%), transparent 60%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    min-height:100svh;
  }

  /* NAV */
  header.nav{
    position:sticky; top:0; z-index:3;
    display:flex; gap:.6rem; flex-wrap:wrap; align-items:center;
    padding:12px 16px;
    backdrop-filter: blur(8px);
    background: color-mix(in oklab, var(--bg0), transparent 36%);
    border-bottom:1px solid color-mix(in oklab, var(--ring), transparent 18%);
  }
  .pill{
    display:inline-flex; align-items:center; gap:.5rem;
    text-decoration:none; color:var(--text-strong);
    border:1px solid var(--btn-border);
    padding:.44rem .8rem; border-radius:999px;
    background: var(--pill-bg);
  }
  .pill[aria-disabled="true"]{opacity:.6; pointer-events:none}

  main{max-width:980px; margin:0 auto; padding:26px 16px 56px}

  /* CARD */
  .card{
    border:1px solid var(--btn-border);
    border-radius:18px; overflow:hidden;
    background: var(--card-bg);
    box-shadow: var(--glow);
    color:var(--text);
  }
  .hero{
    padding:20px 20px 0;
    background:
      radial-gradient(700px 260px at 10% -10%, color-mix(in oklab, var(--accent), transparent 78%), transparent 60%),
      linear-gradient(180deg, transparent, color-mix(in oklab, var(--bg1), transparent 70%));
    border-bottom:1px solid color-mix(in oklab, var(--ring), transparent 26%);
  }
  h1{
    margin:.1rem 0 .1rem;
    font-size:clamp(22px,3.4vw,32px); font-weight:800; letter-spacing:.2px;
    color:var(--text-strong);
    text-shadow:0 1px 0 rgba(0,0,0,.04);
  }
  p.purpose{margin:.2rem 0 1rem; color:var(--text-soft)}

  .vid-wrap{width:100%; aspect-ratio:16/9; background:#000; border-radius:14px; overflow:hidden; border:1px solid var(--btn-border)}
  .vid-wrap iframe{width:100%; height:100%; display:block; border:0}

  .section{padding:16px 20px 20px}
  .controls{display:flex; gap:.6rem; flex-wrap:wrap; margin:12px 0 2px}

  /* HIGH-CONTRAST BUTTONS */
  .btn{
    appearance:none; cursor:pointer;
    border:1px solid var(--btn-border);
    background: var(--btn-bg);
    color: var(--text);
    border-radius:12px; padding:.62rem .9rem;
    font-weight:600;
  }
  .btn:hover{ background: var(--btn-bg-hover); }
  .btn:focus-visible{ outline:3px solid color-mix(in oklab, var(--accent), transparent 35%); outline-offset:2px }
  .btn:active{ transform: translateY(1px) }

  /* TINT */
  .tint{
    margin:16px 0 0; padding:12px;
    border:1px dashed var(--btn-border); border-radius:12px;
    background: color-mix(in oklab, var(--card-bg), white 6%);
    color:var(--text);
  }
  .tint label{display:block; margin-bottom:.35rem; color:var(--text)}
  .tint input[type=range]{width:100%}

  .next{margin:14px 0 0}
  .next a{color:var(--text-strong); text-decoration:none; border-bottom:1px dashed color-mix(in oklab, var(--btn-border), transparent 35%)}

  details.more{margin-top:18px}
  summary{cursor:pointer; color:var(--text-strong)}
  .more-box{display:flex; flex-wrap:wrap; gap:.5rem; margin-top:.6rem}
  .badge{font:12px system-ui; opacity:.8; margin-top:8px; color:var(--text-soft)}

  /* subtle honey film controlled by slider */
  .honey-film{
    pointer-events:none; position:fixed; inset:0; z-index:1; mix-blend-mode:soft-light; opacity:0;
    background: radial-gradient(1200px 600px at 0% 0%, color-mix(in oklab, var(--accent), transparent 60%), transparent 60%),
                radial-gradient(800px 400px at 100% 100%, color-mix(in oklab, var(--accent), transparent 72%), transparent 60%);
    transition: opacity .25s ease;
  }
</style>
</head>
<body>

<div class="honey-film" id="honeyFilm" aria-hidden="true"></div>

<header class="nav" data-plnt="nav" aria-label="Global navigation"></header>

<main>
  <div class="card">
    <div class="hero">
      <h1 data-plnt="title">üçØ MirrorHoney</h1>
      <p class="purpose" data-plnt="purpose">Send one drop of honey.</p>
    </div>

    <div class="section">
      <section class="vid-wrap" aria-label="Featured video">
        <!-- Default to Hello Kitty; JSON can override -->
        <iframe id="mh-video"
          title="MirrorHoney Video"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen
          loading="lazy"
          referrerpolicy="strict-origin-when-cross-origin"
          src="https://www.youtube-nocookie.com/embed/81tlcIq4kPA?rel=0&modestbranding=1&playsinline=1">
        </iframe>
      </section>

      <div class="controls" data-plnt="actions" aria-label="Actions">
        <!-- JSON-rendered buttons go here -->
      </div>

      <div class="tint" id="tintBox" hidden>
        <label for="tintRange">Color tint</label>
        <input id="tintRange" type="range" min="0" max="100" step="1" aria-label="Color tint amount" />
      </div>

      <p class="next" data-plnt="next"></p>

      <details class="more">
        <summary>More</summary>
        <div class="more-box" data-plnt="more"></div>
        <div id="nav-health" class="badge" aria-live="polite"></div>
      </details>
    </div>
  </div>
</main>

<script>
/* identity & canon */
window.CURRENT_SLUG = "mirrorhoney";
const CANON = "https://www.plnt.earth/rooms.json";
const CACHE_KEY = "plnt.rooms.v1";

/* helpers (no logs) */
function $(sel){ return document.querySelector(sel); }
function setVideoFromUrl(url){
  try{
    var id="",start=0,u=new URL(url);
    if(u.hostname.includes("youtu.be")) id=u.pathname.slice(1);
    if(u.hostname.includes("youtube")) id=u.searchParams.get("v")||"";
    var t=u.searchParams.get("t")||u.searchParams.get("start")||"";
    if(t){ var s=(t+"").replace(/s$/,""); if(!isNaN(parseInt(s,10))) start=parseInt(s,10); }
    if(!id) return false;
    var src="https://www.youtube-nocookie.com/embed/"+id+"?rel=0&modestbranding=1&playsinline=1";
    if(start>0) src+="&start="+start;
    var f=$("#mh-video"); if(f) f.src=src;
    return true;
  }catch(_){ return false; }
}
function roomLink(room){
  var href="https://"+room.slug+".plnt.earth";
  if(room.coming_soon||room.status!=="live") return {label:(room.glyph?room.glyph+" ":"")+room.title+" ‚Äî Coming Soon",href:"#",disabled:true};
  return {label:(room.glyph?room.glyph+" ":"")+room.title,href:href,disabled:false};
}

/* fetch rooms.json with fallback + cache */
(async function(){
  var inline=null,cached=null;
  try{ var el=document.getElementById("rooms-fallback"); if(el) inline=JSON.parse(el.textContent);}catch(_){}
  try{ cached=JSON.parse(localStorage.getItem(CACHE_KEY)); }catch(_){}
  var data=cached||inline||null, badge=document.getElementById("nav-health");

  try{
    var r=await fetch(CANON,{mode:"cors",cache:"no-store"});
    if(r.ok){
      var fresh=await r.json();
      data=fresh; try{ localStorage.setItem(CACHE_KEY,JSON.stringify(fresh)); }catch(_){}
      if(badge) badge.textContent="Nav: www canon ‚úì";
    } else { if(badge) badge.textContent="Nav issue: status"; }
  }catch(_){ if(badge) badge.textContent="Nav issue: CORS/network"; }

  window.PLNT_ROOMS=data||{rooms:[]};
  renderNav(window.PLNT_ROOMS);
  renderRoom("mirrorhoney");
})();

/* renderers */
function renderNav(d){
  var nav=document.querySelector("[data-plnt=nav]"); if(!nav) return;
  nav.innerHTML="";
  var home=document.createElement("a");
  home.href=d.hub&&d.hub.home?d.hub.home:"https://www.plnt.earth";
  home.textContent=d.hub&&d.hub.title?d.hub.title:"PLNT Earth";
  home.className="pill"; nav.appendChild(home);
  var primary=(d.rooms||[]).filter(r=>r.status==="live").slice(0,7);
  primary.forEach(r=>{
    var i=roomLink(r),a=document.createElement("a");
    a.href=i.href; a.textContent=i.label; a.className="pill";
    if(i.disabled) a.setAttribute("aria-disabled","true");
    nav.appendChild(a);
  });
  var moreBox=document.querySelector("[data-plnt=more]");
  if(moreBox){
    moreBox.innerHTML="";
    var more=(d.rooms||[]).filter(r=>r.status!=="live"||r.coming_soon);
    more.forEach(r=>{
      var i=roomLink(r),a=document.createElement("a");
      a.href=i.href; a.textContent=i.label; a.className="pill";
      if(i.disabled) a.setAttribute("aria-disabled","true");
      moreBox.appendChild(a);
    });
  }
}

function renderRoom(slug){
  var d=window.PLNT_ROOMS||{rooms:[]};
  var room=(d.rooms||[]).find(r=>r.slug===slug)||null;

  var title=$("[data-plnt=title]"), purpose=$("[data-plnt=purpose]");
  if(title){
    var glyph = room && room.glyph ? room.glyph + " " : "";
    var name  = room && room.title ? room.title : "MirrorHoney";
    title.textContent = glyph + name;
  }
  if(purpose) purpose.textContent=room&&room.purpose?room.purpose:"Send one drop of honey.";

  try{ if(room&&room.theme&&room.theme.color){ document.documentElement.style.setProperty("--accent",room.theme.color); } }catch(_){}

  var actionsBox=$("[data-plnt=actions]");
  if(actionsBox){
    actionsBox.innerHTML="";
    var actions=(room&&room.actions)?room.actions.slice(0,3):[];
    actions.forEach(a=>{
      var b=document.createElement("button");
      b.type="button"; b.className="btn"; b.textContent=a.label||"Do";
      b.onclick=function(){
        if(a.type==="video"&&a.target){ setVideoFromUrl(a.target); }
        if(a.type==="toggle"){ b.setAttribute("aria-pressed", b.getAttribute("aria-pressed")==="true"?"false":"true"); }
        if(a.type==="tone"&&a.hz){ toneOnce(a.hz,(a.seconds||10)); }
        if(a.type==="slider"){ var tb=document.getElementById("tintBox"); if(tb) tb.hidden=false; }
        if(a.type==="link"&&a.target){ location.href=a.target; }
      };
      actionsBox.appendChild(b);
    });
  }

  /* prefer JSON video; else keep Hello Kitty default already in iframe */
  try{
    var vidAct=(room&&room.actions)?room.actions.find(x=>x.type==="video"&&x.target):null;
    if(vidAct&&vidAct.target){ setVideoFromUrl(vidAct.target); }
  }catch(_){}

  var next=$("[data-plnt=next]");
  if(next){
    next.innerHTML="";
    if(room&&room.next){
      var a=document.createElement("a");
      a.href="https://"+room.next.slug+".plnt.earth";
      a.textContent=room.next.label||"Next ‚Üí";
      next.appendChild(a);
    }
  }

  /* tint + honey film */
  var tint=document.getElementById("tintRange"), tintBox=document.getElementById("tintBox"), film=document.getElementById("honeyFilm");
  if(tint&&tintBox&&film){
    var hasSlider=room&&room.actions&&room.actions.some(a=>a.type==="slider");
    tintBox.hidden=!hasSlider;
    var key="mirrorhoney.tint";
    try{
      var saved=localStorage.getItem(key);
      if(saved===null){ tint.value = 28; } else { tint.value = saved; }
    }catch(_){ tint.value = 28; }
    tint.addEventListener("input", function(){
      try{ localStorage.setItem(key,String(tint.value)); }catch(_){}
      var v=Math.max(0,Math.min(100,parseInt(tint.value||"0",10)));
      film.style.opacity = v/110;
    });
    var ev=new Event("input"); tint.dispatchEvent(ev);
  }
}

/* tiny WebAudio tone */
function toneOnce(hz,seconds){
  try{
    var ctx=(window._plntAudioCtx)||new (window.AudioContext||window.webkitAudioContext)();
    window._plntAudioCtx=ctx;
    var o=ctx.createOscillator(), g=ctx.createGain();
    o.type="sine"; o.frequency.value=hz||128; g.gain.value=0.0001;
    o.connect(g); g.connect(ctx.destination); o.start();
    var now=ctx.currentTime;
    g.gain.setTargetAtTime(0.09,now,0.05);
    g.gain.setTargetAtTime(0.0001,now+(seconds||10),0.15);
    o.stop(now+(seconds||10)+0.3);
  }catch(_){}
}
</script>

<!-- Optional inline fallback shape -->
<script id="rooms-fallback" type="application/json">{ "updated": "", "rooms": [] }</script>
</body>
</html>
