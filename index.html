<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>MirrorHoney â€” Marina Â· Butterfly Mirror</title>
<meta name="theme-color" content="#0b0d11" media="(prefers-color-scheme: dark)">
<meta name="theme-color" content="#0b0d11">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
:root{
  --bg:#0b0d11;--ink:#f3f4ff;--muted:#b8bed6;--accent:#b7a7ff;--accent2:#73e7ff;
  --glass:rgba(255,255,255,.07);--glass-strong:rgba(255,255,255,.12);
  --rim:rgba(255,255,255,.20);--radius:18px;--shadow:0 18px 40px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.05);
}
*{box-sizing:border-box}html,body{height:100%}
body{
  margin:0;background:
  radial-gradient(1100px 700px at -10% -20%, rgba(183,167,255,.18), transparent 60%),
  radial-gradient(900px 600px at 110% 10%, rgba(115,231,255,.12), transparent 60%),
  linear-gradient(180deg,#0b0d11,#0a0a12 45%,#0b0d11 100%);
  color:var(--ink);font:16px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial;
  -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
}
.container{max-width:1080px;margin:0 auto;padding:18px 14px 80px}
.header{
  position:sticky;top:0;z-index:20;margin:-18px -14px 18px;padding:14px 12px;
  backdrop-filter:saturate(1.1) blur(10px);
  background:linear-gradient(180deg,rgba(18,20,30,.65),rgba(18,20,30,.35));
  border-bottom:1px solid rgba(255,255,255,.08);
}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:38px;height:38px;border-radius:12px;display:grid;place-items:center;
  background:linear-gradient(135deg, rgba(183,167,255,.45), rgba(115,231,255,.28));
  box-shadow:0 0 0 2px rgba(220,209,255,.6), 0 0 40px rgba(183,167,255,.2);font-size:18px}
.title{font-weight:700;letter-spacing:.3px}
.subtitle{color:var(--muted);font-size:14px;margin-top:2px}
.toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.tab{border:1px solid rgba(255,255,255,.10);background:var(--glass);color:var(--ink);
  padding:8px 12px;border-radius:14px;cursor:pointer;transition:transform .08s ease,border-color .15s ease,background .15s ease}
.tab:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.2)}
.tab[aria-pressed="true"]{background:linear-gradient(135deg, rgba(183,167,255,.28), rgba(115,231,255,.18));border-color:rgba(255,255,255,.26)}
.grid{display:grid;gap:14px;grid-template-columns:repeat(12,1fr)}
.col-6{grid-column:span 6}.col-4{grid-column:span 4}.col-8{grid-column:span 8}.col-12{grid-column:span 12}
@media (max-width:1000px){.col-6,.col-8{grid-column:span 12}}
.card{position:relative;background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03));
  border:1px solid rgba(255,255,255,.10);border-radius:18px;box-shadow:var(--shadow);padding:14px}
.gloss{position:absolute;inset:0;pointer-events:none;background:linear-gradient(180deg,rgba(255,255,255,.1),transparent 22%,transparent 78%,rgba(255,255,255,.05));mix-blend-mode:screen;opacity:.35}
.h{font-weight:700}
.h1{font-size:18px}.h2{font-size:14px;color:var(--muted);margin-top:2px}
.body{font-size:14px;color:#e9ebff}.muted{color:var(--muted)}
.row{display:flex;align-items:center;justify-content:space-between;gap:12px}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.btn{appearance:none;border:1px solid rgba(255,255,255,.12);background:var(--glass);color:var(--ink);
  border-radius:12px;padding:8px 12px;font-size:13px;cursor:pointer}
.btn:hover{border-color:rgba(255,255,255,.22)}
.btn.primary{background:linear-gradient(135deg, rgba(183,167,255,.32), rgba(115,231,255,.22));border-color:rgba(255,255,255,.26)}
.input,textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.05);color:var(--ink)}
.small{font-size:12px}
.kbd{font:12px/1 ui-monospace,SFMono-Regular,Menlo,monospace;color:var(--muted);border:1px solid rgba(255,255,255,.15);padding:3px 6px;border-radius:6px;background:rgba(255,255,255,.04)}
.stack{display:flex;flex-direction:column;gap:10px}
.pillrow{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
.pill{border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.05);border-radius:999px;padding:6px 10px;font-size:12px;color:var(--muted)}
.section{margin:10px 0 6px;padding-left:10px;border-left:3px solid rgba(183,167,255,.35);color:var(--muted);font-size:14px}
iframe{width:100%;aspect-ratio:16/9;border:0;border-radius:14px;background:#000}
.queue{display:flex;flex-direction:column;gap:8px;margin-top:10px}
.item{display:flex;gap:10px;align-items:center;justify-content:space-between;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);padding:10px;border-radius:12px}
.item .meta{display:flex;gap:10px;align-items:center;min-width:0}
.item .thumb{width:56px;height:32px;flex:0 0 auto;border-radius:8px;background:#111;display:block;background-size:cover;background-position:center}
.item .title{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;max-width:520px}
.hidden{display:none!important}
.poem{font-size:14px;letter-spacing:.2px;line-height:1.7;color:#f2f3ff}
.poem i{opacity:.85}
</style>
</head>
<body>
<div class="container">
  <header class="header">
    <div class="brand">
      <div class="logo">ðŸªž</div>
      <div>
        <div class="title h">MirrorHoney</div>
        <div class="subtitle">Marinaâ€™s mirror Â· glass calm Â· poems that play</div>
      </div>
    </div>
    <div class="toolbar" role="toolbar" aria-label="Time-of-day lanes">
      <button class="tab" data-lane="morning" aria-pressed="false">Morning Â· Open</button>
      <button class="tab" data-lane="midday" aria-pressed="false">Midday Â· Flow</button>
      <button class="tab" data-lane="night" aria-pressed="false">Night Â· Archive</button>
      <button class="tab" id="selfcheckBtn" aria-pressed="false">Run Self-Check</button>
    </div>
  </header>

  <div class="grid">
    <section class="card col-6" id="poemCard">
      <div class="gloss"></div>
      <div class="h1">todayâ€™s mirror</div>
      <div class="h2" id="laneLabel">route: detecting lightâ€¦</div>
      <div class="poem" id="poem">
        i set the glass down where your breath wonâ€™t break it.<br>
        we listen first. <i>then</i> we decide what to carry.
      </div>
      <div class="pillrow">
        <span class="pill" id="clock"></span>
        <span class="pill" id="mood"></span>
        <span class="pill">Butterfly Mirror</span>
      </div>
      <div class="controls">
        <button class="btn" id="cyclePoem">New Line</button>
        <button class="btn" id="copyLine">Copy Line</button>
      </div>
    </section>

    <section class="card col-6" id="toneCard">
      <div class="gloss"></div>
      <div class="row">
        <div>
          <div class="h1">honey tone</div>
          <div class="h2">tap Start Session once on iOS to unlock audio</div>
        </div>
        <div class="controls">
          <button class="btn primary" id="startAudio">Start Session</button>
          <button class="btn" id="stopAudio">Stop</button>
        </div>
      </div>
      <div class="stack">
        <div class="row">
          <button class="btn" data-freq="128">128 Hz</button>
          <button class="btn" data-freq="160">160 Hz</button>
          <span class="muted small" id="freqLabel">freq: â€”</span>
        </div>
        <label class="small">volume
          <input id="vol" class="input" type="range" min="0" max="1" step="0.001" value="0.25">
        </label>
        <div class="small muted" id="audioState">audio: locked</div>
      </div>
    </section>

    <section class="card col-12" id="playerCard">
      <div class="gloss"></div>
      <div class="row">
        <div>
          <div class="h1">mirror player</div>
          <div class="h2">official videos only Â· add a YouTube link, Iâ€™ll fetch the title</div>
        </div>
        <div class="controls">
          <button class="btn primary" id="playFirst">Play First</button>
          <button class="btn" id="prevBtn">Prev</button>
          <button class="btn" id="nextBtn">Next</button>
          <button class="btn" id="exportBtn">Export</button>
          <label class="btn" for="importFile">Import<input id="importFile" type="file" accept="application/json" class="hidden"></label>
        </div>
      </div>
      <div class="stack">
        <iframe id="yt" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen referrerpolicy="strict-origin-when-cross-origin"></iframe>
        <div class="row">
          <input id="ytInput" class="input" placeholder="Paste YouTube linkâ€¦">
          <button class="btn" id="addBtn">Add</button>
        </div>
        <div class="queue" id="queue"></div>
        <div class="small muted">tip: background play on iOS depends on Safari state. if audio stops after lock, unlock and tap Start Session again â€” your place is saved.</div>
      </div>
    </section>

    <section class="card col-12" id="selfCard" aria-live="polite">
      <div class="gloss"></div>
      <div class="h1">self-check</div>
      <div class="h2">automated checks based on your brief</div>
      <div class="stack" id="results"></div>
    </section>
  </div>
</div>

<script>
(function(){
  var lane='';var poems={
    morning:[
      "we begin where the light is kind.",
      "open palms, open glass; no hurry, only breath.",
      "today is soft: let the mirror choose its angle."
    ],
    midday:[
      "the beam sharpens; we work in clear lines.",
      "rhythm first, then color; the rest bows to flow.",
      "clarity is a kindness: shape what wants to live."
    ],
    night:[
      "the day folds itself into a small bright shell.",
      "write one truth, then let the water keep it.",
      "close gently; even stars need rooms to rest."
    ]
  };
  function detectLane(){
    var d=new Date();var h=d.getHours();
    var L=h<12?'morning':(h<18?'midday':'night');
    setLane(L);
  }
  function setLane(L){
    lane=L;
    var label=document.getElementById('laneLabel');
    if(L==='morning'){label.textContent='route: Morning Â· Open';document.getElementById('mood').textContent='mood Â· petal';}
    if(L==='midday'){label.textContent='route: Midday Â· Flow';document.getElementById('mood').textContent='mood Â· beam';}
    if(L==='night'){label.textContent='route: Night Â· Archive';document.getElementById('mood').textContent='mood Â· hush';}
    cyclePoem();
    setPressed(L);
  }
  function setPressed(L){
    Array.prototype.forEach.call(document.querySelectorAll('.tab[data-lane]'),function(b){
      b.setAttribute('aria-pressed', b.getAttribute('data-lane')===L?'true':'false');
    });
  }
  function cyclePoem(){
    var p=poems[lane]||poems.morning;
    var t=p[Math.floor(Math.random()*p.length)];
    document.getElementById('poem').textContent=t;
  }
  document.getElementById('cyclePoem').addEventListener('click',cyclePoem);
  document.getElementById('copyLine').addEventListener('click',function(){
    var t=document.getElementById('poem').textContent;
    if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(t);}
  });
  setInterval(function(){
    var d=new Date();document.getElementById('clock').textContent='time Â· '+d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  },1000);

  var AC=null,osc=null,gain=null,currentFreq=0,unlocked=false;
  function ensureAC(){
    if(!AC){AC=new (window.AudioContext||window.webkitAudioContext)();gain=AC.createGain();gain.gain.value=parseFloat(localStorage.getItem('mh_vol')||'0.25');gain.connect(AC.destination);}
  }
  function startAudio(){
    ensureAC();
    if(AC.state==='suspended'){AC.resume();}
    if(!osc){osc=AC.createOscillator();osc.type='sine';osc.frequency.value=currentFreq||128;osc.connect(gain);osc.start();}
    unlocked=true;persist('mh_unlocked','1');updateAudioState();
  }
  function stopAudio(){
    if(osc){try{osc.stop()}catch(e){};osc.disconnect();osc=null;}
    updateAudioState();
  }
  function setFreq(f){
    currentFreq=f;persist('mh_freq',String(f));
    if(osc){osc.frequency.setTargetAtTime(f, AC.currentTime, 0.01);}
    document.getElementById('freqLabel').textContent='freq: '+f+' Hz';
  }
  document.getElementById('startAudio').addEventListener('click',startAudio);
  document.getElementById('stopAudio').addEventListener('click',stopAudio);
  Array.prototype.forEach.call(document.querySelectorAll('#toneCard [data-freq]'),function(b){
    b.addEventListener('click',function(){ setFreq(parseFloat(b.getAttribute('data-freq'))); });
  });
  document.getElementById('vol').addEventListener('input',function(e){
    ensureAC();var v=parseFloat(e.target.value||'0');gain.gain.setTargetAtTime(v, AC.currentTime, 0.01);persist('mh_vol',String(v));
  });
  function updateAudioState(){
    var s='audio: '+(unlocked?'running':'locked'); if(AC){s+=' Â· '+AC.state;}
    document.getElementById('audioState').textContent=s;
  }
  document.addEventListener('visibilitychange',function(){
    if(document.visibilityState==='visible'){ if(AC&&AC.state==='suspended'&&localStorage.getItem('mh_unlocked')==='1'){AC.resume();updateAudioState();} }
  });

  var yt=document.getElementById('yt');var queueEl=document.getElementById('queue');
  var Q=[];var idx=0;
  function loadQueue(){
    try{Q=JSON.parse(localStorage.getItem('mh_queue')||'[]');}catch(e){Q=[]}
    if(!Array.isArray(Q)){Q=[]}
    renderQueue();
    var pi=parseInt(localStorage.getItem('mh_idx')||'0',10);if(!isNaN(pi)){idx=Math.max(0,Math.min(Q.length-1,pi));}
    playIndex(idx,false);
  }
  function persist(k,v){localStorage.setItem(k,v)}
  function renderQueue(){
    queueEl.innerHTML='';
    if(!Q.length){var d=document.createElement('div');d.className='muted';d.textContent='empty queue â€” add a YouTube link above';queueEl.appendChild(d);return}
    Q.forEach(function(item,i){
      var row=document.createElement('div');row.className='item';
      var meta=document.createElement('div');meta.className='meta';
      var thumb=document.createElement('a');thumb.className='thumb';thumb.href=item.url;thumb.target='_blank';
      thumb.style.backgroundImage='url(https://i.ytimg.com/vi/'+item.id+'/hqdefault.jpg)';
      var title=document.createElement('div');title.className='title';title.textContent=item.title||item.id;
      meta.appendChild(thumb);meta.appendChild(title);
      var right=document.createElement('div');right.style.display='flex';right.style.gap='8px';
      var playB=document.createElement('button');playB.className='btn';playB.textContent=(i===idx?'Playing':'Play');playB.addEventListener('click',function(){playIndex(i,true)});
      var delB=document.createElement('button');delB.className='btn';delB.textContent='Remove';delB.addEventListener('click',function(){Q.splice(i,1);persist('mh_queue',JSON.stringify(Q));if(idx>=Q.length){idx=Math.max(0,Q.length-1);}renderQueue();playIndex(idx,false)});
      right.appendChild(playB);right.appendChild(delB);
      row.appendChild(meta);row.appendChild(right);queueEl.appendChild(row);
    });
  }
  function ytIdFrom(url){
    try{
      if(/^[\w-]{11}$/.test(url))return url;
      var u=new URL(url);var v=u.searchParams.get('v');if(v&&/^[\w-]{11}$/.test(v))return v;
      var p=u.pathname.split('/');var last=p[p.length-1];if(/^[\w-]{11}$/.test(last))return last;
    }catch(e){}
    return '';
  }
  function fetchTitle(id,cb){
    var o='https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v='+id+'&format=json';
    fetch(o,{mode:'cors'}).then(function(r){return r.json()}).then(function(j){cb(j.title||id)}).catch(function(){cb(id)});
  }
  function playIndex(i,scroll){
    if(!Q.length){yt.src='';return}
    idx=Math.max(0,Math.min(Q.length-1,i));persist('mh_idx',String(idx));
    var item=Q[idx];yt.src='https://www.youtube.com/embed/'+item.id+'?rel=0&modestbranding=1&playsinline=1&enablejsapi=0&autoplay=1';
    renderQueue();
    if(scroll){yt.scrollIntoView({behavior:'smooth',block:'start'});}
  }
  document.getElementById('playFirst').addEventListener('click',function(){playIndex(0,true)});
  document.getElementById('prevBtn').addEventListener('click',function(){if(Q.length){playIndex((idx-1+Q.length)%Q.length,true)}});
  document.getElementById('nextBtn').addEventListener('click',function(){if(Q.length){playIndex((idx+1)%Q.length,true)}});
  document.getElementById('addBtn').addEventListener('click',function(){
    var raw=document.getElementById('ytInput').value.trim();if(!raw)return;
    var id=ytIdFrom(raw);if(!id)return;
    var url='https://www.youtube.com/watch?v='+id;
    fetchTitle(id,function(title){
      Q.push({id:id,url:url,title:title});
      persist('mh_queue',JSON.stringify(Q));
      document.getElementById('ytInput').value='';
      renderQueue();
      if(Q.length===1){playIndex(0,false)}
    });
  });
  document.getElementById('exportBtn').addEventListener('click',function(){
    var data=JSON.stringify(Q);var blob=new Blob([data],{type:'application/json'});
    var a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='mirrorhoney_queue.json';a.click();
    setTimeout(function(){URL.revokeObjectURL(a.href)},1500);
  });
  document.getElementById('importFile').addEventListener('change',function(e){
    var f=e.target.files[0];if(!f)return;var r=new FileReader();
    r.onload=function(){try{var arr=JSON.parse(r.result||'[]');if(Array.isArray(arr)){Q=arr.filter(Boolean);persist('mh_queue',JSON.stringify(Q));renderQueue();playIndex(0,false);}}catch(err){}};
    r.readAsText(f);
  });

  function passRow(name,ok,detail){
    var row=document.createElement('div');row.className='item';
    var meta=document.createElement('div');meta.className='meta';var title=document.createElement('div');title.className='title';title.textContent=name+(ok?' Â· PASS':' Â· CHECK');
    var note=document.createElement('div');note.className='muted small';note.textContent=detail||'';
    meta.appendChild(title);meta.appendChild(note);
    var tag=document.createElement('div');tag.className='pill';tag.textContent=ok?'ok':'attention';
    row.appendChild(meta);row.appendChild(tag);
    document.getElementById('results').appendChild(row);
  }
  function runSelfCheck(){
    var results=document.getElementById('results');results.innerHTML='';
    var a1=!!window.AudioContext||!!window.webkitAudioContext;passRow('Audio engine available',a1,a1?'WebAudio present':'No WebAudio');
    ensureAC();var s1=!!AC;passRow('AudioContext created',s1,s1?AC.state:'failed');
    var u1=unlocked||localStorage.getItem('mh_unlocked')==='1';passRow('iOS unlock state',u1,u1?'unlocked or remembered':'tap Start Session once');
    var f=localStorage.getItem('mh_freq');passRow('Tone frequency remembered',!!f,f?f+' Hz':'not set');
    var v=localStorage.getItem('mh_vol');passRow('Volume remembered',!!v,v?v:'not set');
    var qlen=Array.isArray(Q)?Q.length:0;passRow('Queue loaded',qlen>=0,'items: '+qlen);
    var ifr=!!document.getElementById('yt').contentWindow||document.getElementById('yt').getAttribute('src')!=='';passRow('YouTube player ready',ifr,ifr?'ok':'add a link and press Play First');
    passRow('Persistence',!!(window.localStorage),'localStorage');
  }
  document.getElementById('selfcheckBtn').addEventListener('click',runSelfCheck);

  Array.prototype.forEach.call(document.querySelectorAll('.tab[data-lane]'),function(b){
    b.addEventListener('click',function(){ setLane(b.getAttribute('data-lane')); });
  });

  function hydrateFromStorage(){
    var f=localStorage.getItem('mh_freq');if(f){currentFreq=parseFloat(f);document.getElementById('freqLabel').textContent='freq: '+f+' Hz'}
    var v=localStorage.getItem('mh_vol');if(v){document.getElementById('vol').value=v}
    if(localStorage.getItem('mh_unlocked')==='1'){unlocked=true;updateAudioState()}
  }

  hydrateFromStorage();
  detectLane();
  loadQueue();
  updateAudioState();
})();
</script>
</body>
</html>
