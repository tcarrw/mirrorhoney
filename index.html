<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MirrorHoney</title>
<meta name="description" content="MirrorHoney ‚Äî one drop of honey, one video, one gentle color tint." />
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --accent:#ffd89a; --ink:#1a1a1a; --bg:#fffaf2; --ring:rgba(0,0,0,.15);
  }
  @media (prefers-color-scheme: dark){
    :root{ --ink:#eee; --bg:#0f0f10; --ring:rgba(255,255,255,.2); }
  }
  *{box-sizing:border-box}
  body{margin:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  header.nav{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center;padding:12px 16px;border-bottom:1px solid var(--ring);position:sticky;top:0;background:color-mix(in oklab, var(--bg), transparent 0%)}
  .pill{display:inline-flex;align-items:center;gap:.5rem;border:1px solid var(--ring);padding:.4rem .7rem;border-radius:999px;text-decoration:none;color:inherit}
  .pill[aria-disabled="true"]{opacity:.5;pointer-events:none}
  main{max-width:900px;margin:0 auto;padding:20px 16px 48px}
  h1{font-weight:700;font-size:clamp(22px,3vw,30px);margin:.2rem 0 .2rem}
  p.purpose{opacity:.9;margin:.2rem 0 1rem}
  .vid-wrap{width:100%;aspect-ratio:16/9;border-radius:16px;overflow:hidden;border:1px solid var(--ring);background:#000}
  .vid-wrap iframe{width:100%;height:100%;display:block;border:0}
  .controls{display:flex;gap:.5rem;flex-wrap:wrap;margin:12px 0 2px}
  .btn{appearance:none;border:1px solid var(--ring);background:transparent;color:inherit;border-radius:12px;padding:.55rem .8rem;cursor:pointer}
  .btn:focus-visible{outline:3px solid color-mix(in oklab, var(--accent), transparent 50%);outline-offset:2px}
  .next{margin-top:14px}
  .next a{color:inherit;text-decoration:none;border-bottom:1px dashed var(--ring)}
  details.more{margin-top:18px}
  summary{cursor:pointer}
  .more-box{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.5rem}
  .tint{position:relative;margin:14px 0 0;padding:10px 12px;border:1px dashed var(--ring);border-radius:12px}
  .tint input[type=range]{width:100%}
  .badge{font:12px system-ui;opacity:.75;margin-top:8px}
</style>
</head>
<body>

<header class="nav" data-plnt="nav" aria-label="Global navigation"></header>

<main>
  <h1 data-plnt="title">üçØ MirrorHoney</h1>
  <p class="purpose" data-plnt="purpose">Send one drop of honey.</p>

  <!-- Responsive YouTube video -->
  <section class="vid-wrap" aria-label="Featured video">
    <iframe id="mh-video"
      title="MirrorHoney Video"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen
      src="https://www.youtube-nocookie.com/embed/81tlcIq4kPA?rel=0&modestbranding=1&playsinline=1">
    </iframe>
  </section>

  <!-- Rendered micro-actions from JSON -->
  <div class="controls" data-plnt="actions" aria-label="Actions"></div>

  <!-- Optional local tint control (also shown if JSON includes a slider action) -->
  <div class="tint" id="tintBox" hidden>
    <label for="tintRange">Color tint</label>
    <input id="tintRange" type="range" min="0" max="100" step="1" aria-label="Color tint amount" />
  </div>

  <p class="next" data-plnt="next"></p>

  <details class="more">
    <summary>More</summary>
    <div class="more-box" data-plnt="more"></div>
    <div id="nav-health" class="badge" aria-live="polite"></div>
  </details>
</main>

<script>
/* page identity & canon */
window.CURRENT_SLUG = "mirrorhoney";
const CANON = "https://www.plnt.earth/rooms.json";
const CACHE_KEY = "plnt.rooms.v1";

/* helpers */
function $(sel){ return document.querySelector(sel); }
function setVideoFromUrl(url){
  try{
    var id="",start=0,u=new URL(url);
    if(u.hostname.includes("youtu.be")) id=u.pathname.slice(1);
    if(u.hostname.includes("youtube")) id=u.searchParams.get("v")||"";
    var t=u.searchParams.get("t")||u.searchParams.get("start")||"";
    if(t){ var s=(t+"").replace(/s$/,""); if(!isNaN(parseInt(s,10))) start=parseInt(s,10); }
    if(!id) return false;
    var src="https://www.youtube-nocookie.com/embed/"+id+"?rel=0&modestbranding=1&playsinline=1";
    if(start>0) src+="&start="+start;
    var f=$("#mh-video"); if(f) f.src=src;
    return true;
  }catch(_){ return false; }
}
function roomLink(room){
  var href="https://"+room.slug+".plnt.earth";
  if(room.coming_soon||room.status!=="live") return {label:(room.glyph?room.glyph+" ":"")+room.title+" ‚Äî Coming Soon",href:"#",disabled:true};
  return {label:(room.glyph?room.glyph+" ":"")+room.title,href:href,disabled:false};
}

/* fetch rooms.json with fallback + cache */
(async function(){
  var inline=null,cached=null;
  try{ var el=document.getElementById("rooms-fallback"); if(el) inline=JSON.parse(el.textContent);}catch(_){}
  try{ cached=JSON.parse(localStorage.getItem(CACHE_KEY)); }catch(_){}
  var data=cached||inline||null, badge=document.getElementById("nav-health");

  try{
    var r=await fetch(CANON,{mode:"cors",cache:"no-store"});
    if(r.ok){
      var fresh=await r.json();
      data=fresh; try{ localStorage.setItem(CACHE_KEY,JSON.stringify(fresh)); }catch(_){}
      if(badge) badge.textContent="Nav: www canon ‚úì";
    } else { if(badge) badge.textContent="Nav issue: status"; }
  }catch(_){ if(badge) badge.textContent="Nav issue: CORS/network"; }

  window.PLNT_ROOMS=data||{rooms:[]};
  renderNav(window.PLNT_ROOMS);
  renderRoom("mirrorhoney");
})();

/* renderers */
function renderNav(d){
  var nav=document.querySelector("[data-plnt=nav]"); if(!nav) return;
  nav.innerHTML="";
  var home=document.createElement("a");
  home.href=d.hub&&d.hub.home?d.hub.home:"https://www.plnt.earth";
  home.textContent=d.hub&&d.hub.title?d.hub.title:"PLNT Earth";
  home.className="pill"; nav.appendChild(home);
  var primary=(d.rooms||[]).filter(r=>r.status==="live").slice(0,7);
  primary.forEach(r=>{
    var i=roomLink(r),a=document.createElement("a");
    a.href=i.href; a.textContent=i.label; a.className="pill";
    if(i.disabled) a.setAttribute("aria-disabled","true");
    nav.appendChild(a);
  });
  var moreBox=document.querySelector("[data-plnt=more]");
  if(moreBox){
    moreBox.innerHTML="";
    var more=(d.rooms||[]).filter(r=>r.status!=="live"||r.coming_soon);
    more.forEach(r=>{
      var i=roomLink(r),a=document.createElement("a");
      a.href=i.href; a.textContent=i.label; a.className="pill";
      if(i.disabled) a.setAttribute("aria-disabled","true");
      moreBox.appendChild(a);
    });
  }
}

function renderRoom(slug){
  var d=window.PLNT_ROOMS||{rooms:[]};
  var room=(d.rooms||[]).find(r=>r.slug===slug)||null;

  var title=$("[data-plnt=title]"), purpose=$("[data-plnt=purpose]");
  if(title) title.textContent=(room&&(room.glyph?room.glyph+" ":""))+(room?room.title:"MirrorHoney");
  if(purpose) purpose.textContent=room&&room.purpose?room.purpose:"Send one drop of honey.";

  try{ if(room&&room.theme&&room.theme.color){ document.documentElement.style.setProperty("--accent",room.theme.color); } }catch(_){}

  var actionsBox=$("[data-plnt=actions]");
  if(actionsBox){
    actionsBox.innerHTML="";
    var actions=(room&&room.actions)?room.actions.slice(0,3):[];
    actions.forEach(a=>{
      var b=document.createElement("button");
      b.type="button"; b.className="btn"; b.textContent=a.label||"Do"; b.dataset.action=a.id||"";
      b.onclick=function(){
        if(a.type==="video"&&a.target){ setVideoFromUrl(a.target); }
        if(a.type==="toggle"){ b.setAttribute("aria-pressed", b.getAttribute("aria-pressed")==="true"?"false":"true"); }
        if(a.type==="tone"&&a.hz){ toneOnce(a.hz,(a.seconds||8)); }
        if(a.type==="slider"){ var tb=document.getElementById("tintBox"); if(tb) tb.hidden=false; }
        if(a.type==="link"&&a.target){ location.href=a.target; }
      };
      actionsBox.appendChild(b);
    });
  }

  /* prefer JSON video; else keep your default (81tlcIq4kPA) already set in iframe */
  try{
    var vidAct=(room&&room.actions)?room.actions.find(x=>x.type==="video"&&x.target):null;
    if(vidAct&&vidAct.target){ setVideoFromUrl(vidAct.target); }
  }catch(_){}

  var next=$("[data-plnt=next]");
  if(next){
    next.innerHTML="";
    if(room&&room.next){
      var a=document.createElement("a");
      a.href="https://"+room.next.slug+".plnt.earth";
      a.textContent=room.next.label||"Next ‚Üí";
      next.appendChild(a);
    }
  }

  var tint=document.getElementById("tintRange"), tintBox=document.getElementById("tintBox");
  if(tint&&tintBox){
    var hasSlider=room&&room.actions&&room.actions.some(a=>a.type==="slider");
    tintBox.hidden=!hasSlider;
    var key="mirrorhoney.tint";
    try{ var saved=localStorage.getItem(key); if(saved!==null) tint.value=saved; }catch(_){}
    tint.addEventListener("input", function(){
      try{ localStorage.setItem(key,String(tint.value)); }catch(_){}
      var v=Math.max(0,Math.min(100,parseInt(tint.value||"0",10)));
      var overlay="linear-gradient(to bottom right, color-mix(in oklab, var(--accent), transparent "+(100-v)+"%), transparent "+(100-v)+"%)";
      document.body.style.backgroundImage = v>0 ? overlay : "none";
    });
    var ev=new Event("input"); tint.dispatchEvent(ev);
  }
}

/* tiny WebAudio tone for 'breath' action */
function toneOnce(hz,seconds){
  try{
    var ctx=(window._plntAudioCtx)||new (window.AudioContext||window.webkitAudioContext)();
    window._plntAudioCtx=ctx;
    var o=ctx.createOscillator(), g=ctx.createGain();
    o.type="sine"; o.frequency.value=hz||128; g.gain.value=0.0001;
    o.connect(g); g.connect(ctx.destination); o.start();
    var now=ctx.currentTime;
    g.gain.setTargetAtTime(0.1,now,0.05);
    g.gain.setTargetAtTime(0.0001,now+(seconds||8),0.15);
    o.stop(now+(seconds||8)+0.3);
  }catch(_){}
}
</script>

</body>
</html>
